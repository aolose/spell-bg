<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>BG3 Spells</title>
    <style>html{background: #171829}</style>
    <link href="0.css" rel="stylesheet"/>
</head>
<body>
<div id="z"></div>
<div class="r">
    <div class="p">
        <div id="c">
        </div>
        <div class="f">
            <div class="v">
                <label>Label</label>
                <input id="v0"/>
            </div>
            <div class="v">
                <label>Value</label>
                <input id="v2"/>
            </div>
        </div>
    </div>
    <div class="g">
        <div id="a">
            <div id="v"></div>
        </div>
        <div id="b"></div>
        <div id="e">X</div>
    </div>
</div>
<script>
    const all = +0
    let l = 0
    const types = "%types%"
    const spells = {}
    const task = []
    let syncA = 0
    let icons = {}
    let ns=[]
    function ok() {
        const v = (++l * 100) / all
        z.style.width = v + '%'
        if (v === 100) z.style.opacity = '0'
    }

    function ico(k, name) {
        const o = icons[k];
        if (o) {
            const {U1, V1} = o;
            const fx = a => (100 * a / (2048 - 64)).toFixed(5) + '%';
            return `background-position:${fx(U1)} ${fx(V1)}`;
        }
        return "background-image:none";
    }

    function loadIcon(i) {
        icons = i
        Object.values(spells).forEach(
            o => o.ico = ico(o.Icon, o.Name)
        )
        if(tbs.run)tbs.ico()
    }

    function loadSpell(arr) {
        task.push(arr)
        if(tbs.run)tbs.run()
    }

    const ft = {};
    const z = document.getElementById("z");
    const a = document.getElementById("a");
    const b = document.getElementById("b");
    const c = document.getElementById("c");
    const e = document.getElementById("e");
    (e.onclick = function () {
        b.className = '';
        e.className = '';
        b.innerHTML = `<pre>
  Last build at %%
  filter ignore case.
· Label:
         The Property name of the spell.
· Value:
         The Value of the Property.
         '-' means empty.
         '*' means not empty.
         '>5' means equal or bigger than 5.
· e.g:
    Label: level  Value:-
</pre>`
    })();
    const el = (t) => {
        const e = document.createElement("div");
        e.innerHTML = t;
        return e.children[0];
    };
    let t = -1
    const tbs = [];
    const cg = (k, t) => {
        ft.t = t;
        tbs.forEach((t) => t.act(k));
        if(tbs.run)tbs.run()
    };
    [""].concat(types).forEach((t) => {
        const n = t || "ALL";
        const b = el(`<div>${n.toUpperCase()}</div>`);
        b.onclick = () => {
            cg(n, t);
        };
        b.act = (k) => {
            b.className = k === n ? "act" : "";
        };
        tbs.push(b);
        c.appendChild(b);
    });
    const x = (id, key) => {
        const v = document.getElementById(id);
        v.oninput = v.onchange = v.onpaste = v.onblur = function () {
            ft[key] = v.value.replace(/^\s+|\s+$/, "");
            syncA++
        };
    };
    x("v0", "k");
    x("v2", "l");
    cg("ALL", "");
</script>
<script src="./r.js" async></script>
%scripts%
</body>
</html>