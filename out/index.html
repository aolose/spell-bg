<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Spells</title>
    <script src="./spells.js"></script>
    <style>
      *{
          margin: 0;
          padding: 0;
          box-sizing: content-box;
          background: none;
      }
      .r{
          position: absolute;
          top: 0;
          left: 0;
          bottom: 0;
          right: 0;
          overflow: auto;
          display: flex;
          background: #171829;
          color: #aaa;
      }
      #a,#b,#c,.f,.c,.g{
          display: flex;
          align-items: center;
      }
      #a{
          height: 100%;
          overflow: auto;
          flex-wrap: wrap;
          flex: 1;
          margin-right: 300px;
          padding: 30px;
      }
      #a::-webkit-scrollbar {
          width: 1em;
      }

      #a::-webkit-scrollbar-track {
          box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
      }

      #a::-webkit-scrollbar-thumb {
          background-color: darkgrey;
          outline: 1px solid slategrey;
      }
      #b{
          position: fixed;
          right: 0;
          width: 300px;
          background: #161d2f;
          height: 100%;
      }
      .p{
          position: fixed;
          left: 0;
          right: 0;
          top: 0;
          padding: 0 30px;
          background: #161d2f;
          height: 50px;
          display: flex;
      }
      .g{
          margin: 50px 0 0;
      }
      .c *{
          white-space: normal;
          word-break: break-all;
      }
      .c label{
          font-size: 13px;
          color: #fff;
      }
      .c{
          width: 300px;
          border: 3px solid #153049;
          margin: 3px;
          height: 100px;
          padding: 10px;
          background: #161d2f;
      }
      .f{

      }
    </style>
</head>
<body>
<div class="r">
   <div class="p">
       <div class="f">
           <div class="v">
               <label>Name</label>
               <input id="v0"/>
           </div>
           <div class="v">
               <label>Damage</label>
               <input id="v1"/>
           </div>
       </div>
       <div id="c">
       </div>
   </div>
   <div class="g">
       <div id="a">

       </div>
       <div id="b">

       </div>
   </div>
</div>
<script>
    const ft = {};
    const a = document.getElementById('a');
    const b = document.getElementById('b');
    const c = document.getElementById('c');
    const {spells, types} = data;
    const el = (t) => {
        const e = document.createElement('div');
        e.innerHTML = t;
        return e.children[0];
    }
    const card = (o) => {
        const {Key, SpellType, SpellProperties = []} = o;
        const v = el(`
<div class="c">
   <label>${Key}</label>

</div>
           `)
        v.d = o;
        v.filter = (t, k, g) => {
            let a = 0;
            const f = (k, Key) => {
                if (k && Key.toLowerCase().indexOf(k.toLowerCase()) === -1) a = 1;
            }
            f(k, Key)
            f(t, SpellType)
            if (g && !isNaN(+g)) {
                let n = 0;
                SpellProperties.forEach(v => {
                    const r = /DealDamage\((\d+)d(\d+),.*?\)/
                    const [, a, b] = r.exec(v) || [];
                    if (b) {
                        if (a * b >= +g) n = 1
                    }
                })
                if (!n) a = 1;
            }
            v.style.display = ['', 'none'][a];
        }
        return v;
    }
    Object.values(spells).sort((a, b) => {
        const v = a.Key > b.Key;
        return v ? 1 : -1;
    }).forEach(o => a.appendChild(card(o)));
    const tbs = [];
    const cg = (k, t) => {
        ft.t = t;
        tbs.forEach(t => t.act(k))
    }
    [''].concat(Object.keys(types)).forEach(t => {
        const n = t || 'ALL';
        const b = el(`<div>${n}</div>`);
        b.onclick = () => {
            cg(n, t);
        }
        b.act = k => {
            b.className = k === n ? 'act' : '';
        }
        tbs.push(b);
        c.appendChild(b);
    })
    cg('ALL','');
</script>
</body>
</html>
